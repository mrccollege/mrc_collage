{% extends 'base.html' %}
{% block content %}

<div class="container">
  <h2>User Login</h2>
  <form id="login_form">{% csrf_token %}
    <div class="form-group mb-3">
      <label for="username"><i class="fas fa-user"></i> Email</label>
      <input type="text" class="form-control" name="username" id="username" placeholder="Enter username" required>
    </div>

    <div class="form-group mb-3">
      <label for="password"><i class="fas fa-lock"></i> Password</label>
      <input type="password" class="form-control" name="password" id="password" placeholder="Enter password" required>
    </div>

    <button type="button" id="login_form_btn" class="btn btn-primary btn-block"><i class="fas fa-user-plus"></i>
      Login</button>
  </form>
  <p class="text-center mt-3">Register For new account? <a href="/accounts/register/">Register</a></p>
</div>

{% endblock content %}

{% block js %}
<script>
  $(document).ready(function () {
    $('#login_form_btn').click(function (e) {
      username = $('#username').val()
      password = $('#password').val();

      if (username == '' || password == '') {
        Swal.fire({
                title: 'Error',
                text: 'Please fill in the required field',
                icon: 'error',
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'OK'
            });
            return false;
      } else {
        e.preventDefault();  // Prevent the form from submitting normally

        var formData = $('#login_form').serialize();  // Serialize the form data

        $.ajax({
          url: '/accounts/login/',  // URL to the Django view
          type: 'POST',
          data: formData,
          success: function (response) {
            // Handle the successful response
            console.log(response.status,'----------status');
            if(response.status == 'success'){
              Swal.fire({
                title: 'Success',
                text: response.msg,
                icon: 'success',
                showCancelButton: false,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'OK'
              }).then((result) => {
                // Redirect to another page or perform additional actions
                window.location.href = '/';
              });
            }else{
              Swal.fire({
                  title: 'Error',
                  text: response.msg,
                  icon: 'error',
                  confirmButtonColor: '#3085d6',
                  confirmButtonText: 'OK'
              });
              return false;
            }

          },
          error: function (xhr, errmsg, err) {
            // Handle the error
            console.log(xhr.status + ": " + xhr.responseText);
            Swal.fire({
                title: 'Error',
                text: 'Please fill correct username or password.',
                icon: 'error',
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'OK'
            });
            return false;
          }
        });
      }
    });
  });

</script>
{% endblock js %}
